{{ define "__subject" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}

{{ define "__description" }}
{{ range $i, $alert := .Alerts }}
{{ if $i }}{{ end }}
Alert: {{ $alert.Annotations.summary }}
Description: {{ $alert.Annotations.description }}
{{ if $alert.Labels.instance }}Instance: {{ $alert.Labels.instance }}{{ end }}
{{ if $alert.Labels.service }}Service: {{ $alert.Labels.service }}{{ end }}
{{ if $alert.Labels.severity }}Severity: {{ $alert.Labels.severity }}{{ end }}
Started: {{ $alert.StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if $alert.EndsAt }}Ended: {{ $alert.EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
{{ end }}
{{ end }}

{{ define "__text_alert_list" }}
{{ range . }}
---
Alert: {{ .Annotations.summary }}{{ if .Labels.severity }} ({{ .Labels.severity }}){{ end }}

Description: {{ .Annotations.description }}

Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Source: {{ .GeneratorURL }}
{{ end }}
{{ end }}

{{ define "slack.default.title" }}
{{ if eq .Status "firing" }}:fire:{{ else }}:white_check_mark:{{ end }} {{ .Status | title }} Alert{{ if gt (len .Alerts) 1 }}s{{ end }}
{{ end }}

{{ define "slack.default.text" }}
{{ if eq .Status "firing" }}
:warning: **Firing Alerts ({{ .Alerts.Firing | len }})**
{{ range .Alerts.Firing }}
â€¢ *{{ .Annotations.summary }}*
  {{ .Annotations.description }}
  {{ if .Labels.service }}Service: `{{ .Labels.service }}`{{ end }}
  {{ if .Labels.instance }}Instance: `{{ .Labels.instance }}`{{ end }}
{{ end }}
{{ end }}

{{ if eq .Status "resolved" }}
:white_check_mark: **Resolved Alerts ({{ .Alerts.Resolved | len }})**
{{ range .Alerts.Resolved }}
â€¢ *{{ .Annotations.summary }}*
  {{ if .Labels.service }}Service: `{{ .Labels.service }}`{{ end }}
  {{ if .Labels.instance }}Instance: `{{ .Labels.instance }}`{{ end }}
{{ end }}
{{ end }}
{{ end }}

{{ define "email.default.subject" }}
{{ template "__subject" . }}
{{ end }}

{{ define "email.default.html" }}
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.header { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
.alert { margin-bottom: 20px; padding: 15px; border-radius: 5px; }
.firing { background-color: #f8d7da; border: 1px solid #f5c6cb; }
.resolved { background-color: #d4edda; border: 1px solid #c3e6cb; }
.critical { background-color: #f5c6cb; border: 1px solid #f1b0b7; }
.warning { background-color: #fff3cd; border: 1px solid #ffeaa7; }
.labels { margin-top: 10px; }
.label { display: inline-block; background-color: #e9ecef; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px; }
</style>
</head>
<body>
<div class="header">
<h2>TaskManagement Alert Notification</h2>
<p><strong>Status:</strong> {{ .Status | title }}</p>
<p><strong>Group:</strong> {{ .GroupLabels.SortedPairs.Values | join " " }}</p>
<p><strong>Time:</strong> {{ .CommonAnnotations.timestamp | default now }}</p>
</div>

{{ if gt (len .Alerts.Firing) 0 }}
<h3>ðŸ”¥ Firing Alerts ({{ .Alerts.Firing | len }})</h3>
{{ range .Alerts.Firing }}
<div class="alert firing {{ .Labels.severity }}">
<h4>{{ .Annotations.summary }}</h4>
<p>{{ .Annotations.description }}</p>
<div class="labels">
{{ range .Labels.SortedPairs }}
<span class="label">{{ .Name }}: {{ .Value }}</span>
{{ end }}
</div>
<p><strong>Started:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
{{ if .GeneratorURL }}<p><strong>Source:</strong> <a href="{{ .GeneratorURL }}">View in Prometheus</a></p>{{ end }}
</div>
{{ end }}
{{ end }}

{{ if gt (len .Alerts.Resolved) 0 }}
<h3>âœ… Resolved Alerts ({{ .Alerts.Resolved | len }})</h3>
{{ range .Alerts.Resolved }}
<div class="alert resolved">
<h4>{{ .Annotations.summary }}</h4>
<p>{{ .Annotations.description }}</p>
<div class="labels">
{{ range .Labels.SortedPairs }}
<span class="label">{{ .Name }}: {{ .Value }}</span>
{{ end }}
</div>
<p><strong>Started:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
<p><strong>Resolved:</strong> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
</div>
{{ end }}
{{ end }}

<hr>
<p style="font-size: 12px; color: #666;">
This alert was generated by TaskManagement Monitoring System.<br>
For more information, visit the <a href="http://grafana.taskmanagement.local">Grafana Dashboard</a>.
</p>
</body>
</html>
{{ end }}

{{ define "pagerduty.default.description" }}
{{ .CommonAnnotations.summary }}{{ if .CommonAnnotations.description }} - {{ .CommonAnnotations.description }}{{ end }}
{{ end }}

{{ define "pagerduty.default.client" }}
TaskManagement Monitoring
{{ end }}

{{ define "pagerduty.default.clientURL" }}
{{ .ExternalURL }}
{{ end }}

{{ define "pagerduty.default.incidents" }}
{{ range . }}
{
  "incident_key": "{{ .GroupLabels.alertname }}/{{ .GroupLabels.instance }}",
  "event_type": "{{ if eq .Status "firing" }}trigger{{ else }}resolve{{ end }}",
  "description": "{{ .Annotations.summary }}",
  "details": {
    "summary": "{{ .Annotations.summary }}",
    "description": "{{ .Annotations.description }}",
    "severity": "{{ .Labels.severity }}",
    "service": "{{ .Labels.service }}",
    "instance": "{{ .Labels.instance }}",
    "started_at": "{{ .StartsAt }}",
    {{ if .EndsAt }}"ended_at": "{{ .EndsAt }}",{{ end }}
    "generator_url": "{{ .GeneratorURL }}"
  }
}{{ if not (last .) }},{{ end }}
{{ end }}
{{ end }}