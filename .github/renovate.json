{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:base",
    "docker:enableMajor",
    ":dependencyDashboard",
    ":semanticCommits",
    ":separatePatchReleases"
  ],
  "timezone": "UTC",
  "schedule": ["before 6am on monday"],
  "labels": ["dependencies", "renovate"],
  "assignees": ["@taskmanagement/devops-team"],
  "reviewers": ["@taskmanagement/core-team"],
  "prConcurrentLimit": 10,
  "prHourlyLimit": 2,
  "stabilityDays": 3,
  "minimumReleaseAge": "3 days",
  "commitMessagePrefix": "deps:",
  "commitMessageAction": "update",
  "commitMessageTopic": "{{depName}}",
  "commitMessageExtra": "to {{newVersion}}",
  "semanticCommits": "enabled",
  "separateMinorPatch": true,
  "separateMajorMinor": true,
  "separateMultipleMajor": true,
  "rangeStrategy": "bump",
  "bumpVersion": "patch",
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on sunday"]
  },
  "packageRules": [
    {
      "description": "Group all non-major dependencies",
      "matchUpdateTypes": ["minor", "patch"],
      "groupName": "all non-major dependencies",
      "groupSlug": "all-minor-patch"
    },
    {
      "description": "Group React ecosystem updates",
      "matchPackagePatterns": ["^react", "^@types/react"],
      "groupName": "React ecosystem",
      "schedule": ["before 6am on tuesday"]
    },
    {
      "description": "Group Next.js ecosystem updates",
      "matchPackagePatterns": ["^next", "^@next/"],
      "groupName": "Next.js ecosystem",
      "schedule": ["before 6am on tuesday"]
    },
    {
      "description": "Group TypeScript ecosystem updates",
      "matchPackagePatterns": ["^typescript", "^@types/", "^ts-"],
      "groupName": "TypeScript ecosystem",
      "schedule": ["before 6am on wednesday"]
    },
    {
      "description": "Group testing dependencies",
      "matchPackagePatterns": ["jest", "vitest", "playwright", "cypress", "@testing-library"],
      "groupName": "testing dependencies",
      "schedule": ["before 6am on thursday"]
    },
    {
      "description": "Group linting and formatting dependencies",
      "matchPackagePatterns": ["eslint", "prettier", "stylelint"],
      "groupName": "linting and formatting",
      "schedule": ["before 6am on friday"]
    },
    {
      "description": "Group build tools",
      "matchPackagePatterns": ["webpack", "vite", "rollup", "esbuild", "turbo"],
      "groupName": "build tools",
      "schedule": ["before 6am on friday"]
    },
    {
      "description": "Auto-merge patch updates for trusted packages",
      "matchUpdateTypes": ["patch"],
      "matchPackagePatterns": [
        "^@types/",
        "^eslint",
        "^prettier",
        "^typescript"
      ],
      "automerge": true,
      "automergeType": "pr",
      "platformAutomerge": true
    },
    {
      "description": "Require manual approval for major updates",
      "matchUpdateTypes": ["major"],
      "dependencyDashboardApproval": true,
      "stabilityDays": 7,
      "minimumReleaseAge": "7 days"
    },
    {
      "description": "Special handling for security updates",
      "matchDatasources": ["npm"],
      "matchDepTypes": ["dependencies", "devDependencies"],
      "vulnerabilityAlerts": {
        "enabled": true,
        "schedule": ["at any time"]
      },
      "osvVulnerabilityAlerts": true
    },
    {
      "description": "Docker base image updates",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["node", "postgres", "redis", "nginx"],
      "schedule": ["before 6am on saturday"],
      "minimumReleaseAge": "7 days"
    },
    {
      "description": "GitHub Actions updates",
      "matchManagers": ["github-actions"],
      "schedule": ["before 6am on saturday"],
      "automerge": true,
      "automergeType": "pr"
    },
    {
      "description": "Pin Docker digests",
      "matchDatasources": ["docker"],
      "pinDigests": true
    },
    {
      "description": "Separate PR for each major update",
      "matchUpdateTypes": ["major"],
      "separateMinorPatch": false,
      "separateMajorMinor": false,
      "separateMultipleMajor": true
    }
  ],
  "vulnerabilityAlerts": {
    "enabled": true,
    "schedule": ["at any time"],
    "dependencyDashboardApproval": false,
    "stabilityDays": 0,
    "minimumReleaseAge": null
  },
  "osvVulnerabilityAlerts": true,
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Dependency Dashboard",
  "dependencyDashboardHeader": "This issue lists Renovate updates and detected dependencies. Read the [Dependency Dashboard](https://docs.renovatebot.com/key-concepts/dashboard/) docs to learn more.",
  "dependencyDashboardFooter": "- [ ] <!-- rebase-check -->Check this box to trigger a request for Renovate to run again on this repository",
  "rebaseWhen": "conflicted",
  "ignorePaths": [
    "**/node_modules/**",
    "**/bower_components/**",
    "**/vendor/**",
    "**/examples/**",
    "**/test/**",
    "**/tests/**",
    "**/__tests__/**"
  ],
  "ignoreDeps": [
    "node"
  ],
  "regexManagers": [
    {
      "fileMatch": ["^Dockerfile$", "Dockerfile.*"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s*ARG .*?_VERSION=(?<currentValue>.*)\\s"
      ],
      "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "fileMatch": ["^package\\.json$"],
      "matchStrings": [
        "\"node\":\\s*\"(?<currentValue>.*)\""
      ],
      "datasourceTemplate": "node-version",
      "depNameTemplate": "node"
    }
  ]
}